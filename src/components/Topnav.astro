<div class="fixed w-full top-0 left-0 z-50">
  <header
    id="header"
    class="flex justify-between px-10 items-center py-3 transition-all border border-transparent fade-down duration-300"
  >
    <span class="font-bold text-2xl text-slate-50">JH</span>

    <!-- Botón hamburguesa (visible solo en tablet y móvil) -->
    <button
      id="menu-toggle"
      class="md:hidden flex flex-col gap-1.5 w-8 h-8 justify-center items-center transition-all"
      aria-label="Toggle menu"
    >
      <span class="block w-6 h-0.5 bg-white transition-all duration-300"></span>
      <span class="block w-6 h-0.5 bg-white transition-all duration-300"></span>
      <span class="block w-6 h-0.5 bg-white transition-all duration-300"></span>
    </button>

    <!-- Navegación desktop (oculta en tablet/móvil) -->
    <nav class="hidden md:flex gap-x-5 font-semibold text-slate-50">
      <a href="#" class="transition hover:scale-105">Home</a>
      <a href="#proyects" class="transition hover:scale-105">Projects</a>
      <a href="#about" class="transition hover:scale-105">About</a>
      <a href="#contact" class="transition hover:scale-105">Contact</a>
    </nav>
  </header>

  <!-- Menú móvil (visible solo cuando está abierto) -->
  <nav
    id="mobile-menu"
    class="md:hidden text-slate-50 flex-col gap-y-20 font-semibold h-fit bg-white/2 backdrop-blur-xs ml-auto mr-2 w-fit mt-1 rounded-xl border border-slate-50/10 px-10 py-6 transition-all duration-300 opacity-0 invisible -translate-y-4"
  >
    <a href="#" class="block transition hover:scale-105 hover:text-blue-400"
      >&bull; Home</a
    >
    <a
      href="#proyects"
      class="block transition hover:scale-105 hover:text-blue-400"
      >&bull; Projects</a
    >
    <a
      href="#about"
      class="block transition hover:scale-105 hover:text-blue-400"
      >&bull; About</a
    >
    <a
      href="#contact"
      class="block transition hover:scale-105 hover:text-blue-400"
      >&bull; Contact</a
    >
  </nav>
</div>

<script>
  addEventListener("DOMContentLoaded", () => {
    const topnav = document.querySelector("#header");
    const nav = document.querySelector("nav");
    const menuToggle = document.querySelector("#menu-toggle");
    const mobileMenu = document.querySelector("#mobile-menu");

    // Toggle menú móvil
    if (menuToggle && mobileMenu) {
      menuToggle.addEventListener("click", () => {
        const isOpen = mobileMenu.classList.contains("opacity-100");

        if (isOpen) {
          // Cerrar menú
          mobileMenu.classList.remove(
            "opacity-100",
            "visible",
            "translate-y-0"
          );
          mobileMenu.classList.add("opacity-0", "invisible", "-translate-y-4");

          // Resetear icono hamburguesa
          const spans = menuToggle.querySelectorAll("span");
          spans[0].classList.remove("rotate-45", "translate-y-2");
          spans[1].classList.remove("opacity-0");
          spans[2].classList.remove("-rotate-45", "-translate-y-2");
        } else {
          // Abrir menú
          mobileMenu.classList.remove(
            "opacity-0",
            "invisible",
            "-translate-y-4"
          );
          mobileMenu.classList.add("opacity-100", "visible", "translate-y-0");

          // Animar icono hamburguesa a X
          const spans = menuToggle.querySelectorAll("span");
          spans[0].classList.add("rotate-45", "translate-y-2");
          spans[1].classList.add("opacity-0");
          spans[2].classList.add("-rotate-45", "-translate-y-2");
        }
      });

      // Cerrar menú al hacer clic en un enlace
      mobileMenu.addEventListener("click", (e) => {
        const link = (e.target as HTMLElement).closest("a");
        if (link) {
          mobileMenu.classList.remove(
            "opacity-100",
            "visible",
            "translate-y-0"
          );
          mobileMenu.classList.add("opacity-0", "invisible", "-translate-y-4");

          const spans = menuToggle.querySelectorAll("span");
          spans[0].classList.remove("rotate-45", "translate-y-2");
          spans[1].classList.remove("opacity-0");
          spans[2].classList.remove("-rotate-45", "-translate-y-2");
        }
      });
    }

    addEventListener("scroll", () => {
      if (!topnav) return;

      if (window.scrollY > 35) {
        topnav.classList.add(
          "bg-slate-900/10",
          "border-slate-50/10",
          "backdrop-blur-xs",
          "rounded-xl",
          "mt-2",
          "mx-2"
        );
        topnav.classList.remove("border-transparent");
      } else {
        topnav.classList.remove(
          "bg-slate-900/10",
          "border-slate-50/10",
          "backdrop-blur-xs",
          "rounded-xl",
          "mt-2",
          "mx-2"
        );
        topnav.classList.add("border-transparent");
      }
    });

    function removeHash() {
      if (window.history && typeof window.history.replaceState === "function") {
        try {
          const clean = window.location.pathname + window.location.search;
          window.history.replaceState(null, "", clean);
        } catch (err) {
          console.warn("No se pudo limpiar el hash:", err);
        }
      }
    }

    if (nav) {
      nav.addEventListener("click", (e) => {
        const link = (e.target as HTMLElement).closest("a");

        if (!link) return;

        const href = link.getAttribute("href");
        if (!href) return;

        if (href === "#") {
          e.preventDefault();
          window.scrollTo({ top: 0, behavior: "smooth" });
          removeHash();
          return;
        }

        if (href.startsWith("#")) {
          e.preventDefault();
          const id = href.slice(1);
          const target = document.getElementById(id);
          if (target) {
            target.scrollIntoView({ behavior: "smooth", block: "start" });
            removeHash();
          } else {
            console.warn(`No existe el elemento con id="${id}"`);
          }
        }
      });
    }

    // Aplicar estilos del scroll también al menú móvil
    if (mobileMenu) {
      mobileMenu.addEventListener("click", (e) => {
        const link = (e.target as HTMLElement).closest("a");

        if (!link) return;

        const href = link.getAttribute("href");
        if (!href) return;

        if (href === "#") {
          e.preventDefault();
          window.scrollTo({ top: 0, behavior: "smooth" });
          removeHash();
          return;
        }

        if (href.startsWith("#")) {
          e.preventDefault();
          const id = href.slice(1);
          const target = document.getElementById(id);
          if (target) {
            target.scrollIntoView({ behavior: "smooth", block: "start" });
            removeHash();
          }
        }
      });
    }

    if (!topnav) return;
    if (window.scrollY > 35) {
      topnav.classList.add(
        "bg-slate-900/10",
        "border-slate-50/10",
        "backdrop-blur-xs",
        "rounded-xl",
        "mt-2",
        "mx-2"
      );
      topnav.classList.remove("border-transparent");
    }
  });
</script>
